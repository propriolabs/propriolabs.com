<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Positive and Negative Value Bar Chart</title>
    <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
   <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
   <style>

   body{
	font-family: sans-serif;
	background-color: #000;
}
.positive{
		fill: rgb(31,151,238);
		fill-opacity: 0.9;
	}
.negative{
		fill: rgb(31,151,238);
		fill-opacity: 0.9;
	}
.axis path,
.axis line {
			fill: none;
			stroke: black;
			shape-rendering: crispEdges;
	}
.axis text {
			font-family: sans-serif;
			font-size: 10px;	
	}
div.tooltip {   
	  position: absolute;     
	  text-align: center;
	  vertical-align: middle;   
	  width: 150px;                  
	  height: 50px;                 
	  padding: 5px; 
	  color: #000000;          
	  font-size: 12px;     
	  background: #FFF;
	  box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
	  border: 2px;  
	  border-radius: 8px;  
	  pointer-events: none;                  
	} 
li{
	overflow:hidden;
	display: inline-block;
}
ul{
	padding-left: 0;
	padding-right: 0;
}
#chart-container{
	float:left;
}

</style>
  </head>

  <body>
      <div id="chart-container"></div>
       <script type="text/javascript">

var dataset;

//Define bar chart function 
	function barChart(dataset){	

		//Set width and height as fixed variables
		var w = 1600;
		var h = 600;
		var padding = 0;

		//Scale function for axes and radius
		var yScale = d3.scale.linear()
						.domain(d3.extent(dataset, function(d){return d.dr_change;}))
						.range([h+padding,padding]);

		var xScale = d3.scale.ordinal()
						.domain(dataset.map(function(d){ return d.name;}))
						.rangeRoundBands([padding,w+padding],.2);

		//To format axis as a percent
		var formatPercent = d3.format("%1");

		//Create y axis
		var yAxis = d3.svg.axis().scale(yScale).orient("left").ticks(5).tickFormat(formatPercent);

		//Define key function
		var key = function(d){return d.name};



		//Create svg element
		var svg = d3.select("#chart-container").append("svg")
				.attr("width", w).attr("height", h)
				.attr("id", "chart");
				//.attr("viewBox", "0 0 "+w+ " "+h)
				//.attr("preserveAspectRatio", "xMinYMin");
		
		//Resizing function to maintain aspect ratio (uses jquery)
		var aspect = w / h;
		var chart = $("#chart");

		//Create barchart
		svg.selectAll("rect")
			.data(dataset, key)
			.enter()
		  	.append("rect")
		    .attr("class", function(d){return d.dr_change < 0 ? "negative" : "positive";})
		    .attr({
		    	x: function(d){
		    		return xScale(d.name);
		    	},
		    	y: function(d){
		    		return yScale(Math.max(0, d.dr_change)); 
		    	},
		    	width: xScale.rangeBand(),
		    	height: function(d){
		    		return Math.abs(yScale(d.dr_change) - yScale(0)); 
		    	}
		    })
		    .on('mouseover', function(d){
							d3.select(this)
							    .style("opacity", 0.2)
							    .style("stroke", "black")
						})
        				.on('mouseout', function(d){
        					d3.select(this)
							.style({'stroke-opacity':0.5,'stroke':'#a8a8a8'})
							.style("opacity",1);
        				});

		//Add y-axis
		//svg.append("g")
	//			.attr("class", "y axis")
	//			.attr("transform", "translate(40,0)")
	//			.call(yAxis);


	
		
	};

	//Load data and call bar chart function 
		d3.csv("transportation_change_2012-2013_small.csv", function(error,data){
			var dataset=[0.48898315399999998, 0.026168822999999997, -0.52354431200000007, -0.45620727500000002, 0.086730956999999997, 0.13122558600000001, 0.39662170399999996, 0.028289795, 0.36532592799999997, 0.395492554, -0.31356811499999998, -1.7814331050000001, -0.34243774399999999, 1.4567108150000001, -1.3705139159999999, -5.2573394780000005, -5.9920806879999997, -4.6704711909999999, -2.9492645260000003, 1.6471099849999999, 3.8095550539999996, 5.7726287840000001, 4.9013977049999999, 2.0835266109999999, 0.24496460000000003, -1.5150146480000002, -2.2925109859999999, -5.2960510249999997, -0.58929443400000003, 2.4076538090000001, 8.6927642820000006, 8.5186157229999999, 4.5328826900000001, 2.3199462890000002, -1.895050049, -5.1219635010000006, -8.8059844970000007, -10.13011169, -8.9485931399999998, -9.8786163330000001, -13.606689449999999, -21.63970947, -27.870208739999999, 14.89360046, -7.5526580810000006, -13.381927490000001, -2.5210723880000003, -2.0575714110000001, -2.5794372559999998, -1.8145141600000001, -4.757324219, -10.21839905, -3.1394195560000004, 3.2823028560000003, -0.042373657000000002, -1.0787506099999999, -1.603515625, 6.6730651860000005, 9.4385223390000004, 5.3707580570000006, 3.7500457760000003, -1.909408569, 11.146789549999999, 3.9454040530000003, -2.4341430659999999, -0.010848999, -0.102355957, -1.8006286619999998, -0.96061706499999999, -1.311294556, -0.16432189899999999, 1.196060181, -1.4495239259999999, -0.27238464400000001, -1.800445557, -2.0989227289999999, 0.13876342799999999, 0.500747681, -0.53903198200000002, -2.1497955319999997, -2.623565674, -4.1642456049999996, -2.384735107, 0.186050415, -1.198242188, -2.1264953609999999, -1.2021636959999999, 4.1796722410000005, 4.86328125, 4.4026031489999999, -0.42747497600000001, -1.0336608890000001, -3.1575622560000003, 3.5457305910000003, 0.46495056200000001, 0.10903930699999999, 0.058990479000000005, 0.163238525, 0.495101929, -0.77070617699999999, -1.419219971, -1.68270874, -1.588638306, -2.293945313, -2.0215911869999998, -0.31817626999999998, -0.53073120100000004, -1.5218963619999999, -2.102081299, -2.0546112060000001, -0.57466125499999998, -0.38848876999999998, -0.48985290500000001, -0.80270385700000002, -1.426681519, -2.2640838619999997, -1.913467407, -0.30303955100000002, 2.0345153809999998, 3.0943603519999998, 4.5743865970000002, 4.8423919680000003, 4.6057586669999999, 0.87965393099999989, -3.8493194580000001, -7.7686920170000002, -10.23036194, -11.620224, -14.075286869999999, -16.54342651, -23.467010500000001, -31.31375122, -36.811019899999998, -18.14328003, -31.79450989, 25.583419800000001, 0.17597961399999998, -13.93710327, -8.8329315190000006, -5.2221527099999996, -9.8562622070000003, -10.55761719, -6.0720672609999999, -1.3908538819999998, -0.15066528300000001, -3.3994293210000004, -2.368164063, -2.6858520510000004, 4.3860321039999999, 2.3599853519999998, 6.5550994870000006, 5.9847717289999993, 0.68928527799999995, 2.237792969, -4.3248596189999997, -3.7243957519999999, 0.76199340799999993, 0.57060241700000003, 1.93006897, 0.15315246599999999, 0.68177795400000007, 1.2670440670000001, 1.007217407, -0.66549682600000004, -1.104110718, -1.537246704, -2.2958374020000001, -1.1540069579999999, -0.361740112, -0.71597290000000002, 0.096923828000000004, -2.0589752200000002, -1.690338135, -0.68388366700000003, -0.28718566899999998, -0.60800170899999995, 1.5500946040000001, 0.313491821, 0.073135376000000002, -0.107467651, -0.435333252, -1.480712891, -1.8170166019999998, -2.1544494630000002, -1.1216735840000001, -0.133850098, 1.719451904, 1.0998687740000002, 1.086639404, 0.84297180199999999, 1.427734375, 0.84690856900000011, 1.1076354980000001, -0.26985168500000001, 0.46453857399999998, -1.8171844480000001, -2.9573516849999999, -4.3818969729999999, -3.6541748049999998, -1.1669616700000001, -2.3507995610000001, 0.020172118999999999, 1.187728882, 0.37966918899999996, 1.537857056, 1.1039581300000001, -0.12339782699999999, -0.53619384799999992, -0.84877014200000001, 2.4661102289999999, 0.0069427490000000007, -3.0648345950000002, -5.6475830079999998, -8.1921234129999991, -10.33433533, -10.718154910000001, -16.190414430000001, -15.52839661, -21.837448120000001, -29.820999149999999, -35.730911249999998, -9.1608428960000001, -16.900939940000001, -0.84924316400000011, -6.9183654789999993, -12.22181702, -9.0784606930000002, -2.8752136230000001, -5.6360015870000009, -9.701599121000001, -6.3828430179999991, -3.3827972410000005, -3.6873626710000003, -4.6056518549999996, -5.0797576900000001, -3.2151336669999999, 6.773925781, 4.8929595949999998, -0.79348754900000007, -1.504776001, -2.7109985349999999, 3.8990936280000001, 2.4468078609999999, 0.38972473099999999, -2.3250732419999998, -3.517608643, -0.25338745100000004, 0.32798767100000004, -0.99880981400000002, -1.184341431]

				if(error){
					console.log(error);
				}
				else{
					data.forEach(function(d) {
						d.dr_change = parseFloat(d.dr_change);
						d.bus_change = parseFloat(d.bus_change);
					});
					for(var i=0; i< 250; i++){
						data.push({name:Math.random(),dr_change: dataset[i],bus_change:Math.random()})
					}

					dataset=data;
					console.log(dataset)
					barChart(dataset);
				}
			});

       </script>
    </div> <!--description-->
  </body>
  </html>